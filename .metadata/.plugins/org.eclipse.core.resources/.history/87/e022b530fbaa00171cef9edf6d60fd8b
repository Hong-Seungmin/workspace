package Server;

import java.io.BufferedReader;
import java.io.InputStreamReader;
import java.io.PrintWriter;
import java.net.Socket;

class ThreadServer extends Thread{
	PrintWriter send;
	BufferedReader buf;
	Socket socket;
	
	ThreadServer(Socket socket) {
		this.socket = socket;
	}
	
	public void run() {
		String name = "";
		
		try {
			buf = new BufferedReader(new InputStreamReader(socket.getInputStream())); // 클라이언트가 보내온 내용 읽기
			send = new PrintWriter(socket.getOutputStream(), true); // 클라이언트에게 데이터 전송하기
			
			name = buf.readLine();
			sendMessage("[" + name + "] 님이 입장 하셨습니다.");
			System.out.println("[" + name + "] 님이 입장 하셨습니다.");
			
			String message = "";
			while((message=buf.readLine()) != null) {
				sendMessage("[" + name + "] : " + message);
			}
		} catch(Exception e) { // 현재 리스트에서 제거와 동시에 모든 클라이언트에게 퇴장을 알린다.
			ChatServer.list.remove(this);
			sendMessage("[" + name + "] 님이 퇴장하셨습니다.");
			System.out.println("[" + name + "] 님이 퇴장하셨습니다.");
		}
	}
	
	public static void sendMessage(String message) { // 모든 클라이언트에게 메시지를 전송
		for(ThreadServer ts : ChatServer.list)
			ts.send.println(message);
	}
}